name: Hourly Amazon Rank

on:
  schedule:
    - cron: "0 * * * *"
  workflow_dispatch:

jobs:
  track-rank:
    runs-on: ubuntu-latest
    env:
      GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
      GCS_BUCKET_NAME: ${{ secrets.GCS_BUCKET_NAME }}
      IPROYAL_HOST: ${{ secrets.IPROYAL_HOST }}
      IPROYAL_PASSWORD: ${{ secrets.IPROYAL_PASSWORD }}
      IPROYAL_PORT: ${{ secrets.IPROYAL_PORT }}
      IPROYAL_USERNAME: ${{ secrets.IPROYAL_USERNAME }}
      GCS_PREFIX: amazon-search-rank/hourly
      MAX_PAGES: "3"
      INPUT_CSV: input.csv

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirement.txt

      - name: Run Amazon rank tracker
        run: python amazon_search_rank.py

